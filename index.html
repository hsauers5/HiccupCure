<html>
<head>
    <script>
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function countdown(beginSeconds, next) {
            var cd = document.getElementById("countdown");
            cd.innerHTML = beginSeconds;

            if (beginSeconds > 0) {
                sleep(1000).then(() => {
                    countdown(--beginSeconds, next);
                });
            } else if (next != null) {
                cd.innerHTML = next;
            }
        }

        var started = false;
        function start() {
            if (started == false) {
                started = true;
                basicCycle();
            }
        }

        function basicCycle() {
            var bIn = document.getElementById("breatheIn");
            breatheIn();
        }

        function breatheIn() {
            var inst = document.getElementById("instructions");
            inst.innerHTML = "Breathe In Deeply";

            var bIn = document.getElementById("breatheIn");
            bIn.beginElement();
            bIn.setAttribute("onend", "pause()");
            countdown(10, 5);
        }

        function pause() {
            var inst = document.getElementById("instructions");
            inst.innerHTML = "Hold Your Breath";
            
            var hold = document.getElementById("holdBreath");
            hold.beginElement();
            hold.setAttribute("onend", "breatheOut()");
            countdown(5, 10);
        }

        function breatheOut() {
            var inst = document.getElementById("instructions");
            inst.innerHTML = "Breathe All the Way Out";
            
            out = document.getElementById("breatheOut");
            out.beginElement();
            countdown(10);
        }

    </script>
</head>

<body>
<div id="animation" onclick="start()">
    <svg height="100%" width="100%">
        <circle id="outer" cx="50%" cy="50%" r="28%" fill="blue">
        </circle>
        <g>
            <circle id="inner" cx="50%" cy="50%" r="12%" fill="red">
                <!--
                <animate attributeType="xml" attributeName="r" from="50" to="150" dur="10s" repeatCount="1" fill="freeze" />
                <animate attributeType="xml" attributeName="r" from="150" to="50" begin="15s" dur="10s" repeatCount="1" fill="freeze" />
                -->

                <!-- JavaScript-Triggered Animations -->
                <animate id="breatheIn" attributeType="xml" attributeName="r" from="12%" to="28%" begin="indefinite" dur="10s" repeatCount="1" fill="freeze" />
                <animate id="holdBreath" attributeType="xml" attributeName="r" from="28%" to="28%" begin="indefinite" dur="5s" repeatCount="1" fill="freeze" />
                <animate id="breatheOut" attributeType="xml" attributeName="r" from="28%" to="12%" begin="indefinite" dur="10s" repeatCount="1" fill="freeze" />
            </circle>
                <text id="instructions" x="50%" y="50%" text-anchor="middle" fill="white" dy="-0.3em" font-family="Arial" font-weight="bold" font-size="48">Hiccup Cure - Tap To Start</text>
                <text id="countdown" x="50%" y="50%" text-anchor="middle" fill="white" dy="1em" font-family="Arial" font-weight="bold" font-size="64">10</text>

        </g>
    </svg>
</div>
<center>
    <!--
    <button onclick="basicCycle()">Begin</button>
    -->
</center>
</body>
</html>